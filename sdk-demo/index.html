<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAL SDK 데모</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
    }
    #log {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
      background-color: #f9f9f9;
    }
    .message {
      margin-bottom: 8px;
      padding: 5px;
    }
    .sent {
      background-color: #e6f7ff;
      border-left: 3px solid #1890ff;
    }
    .received {
      background-color: #f6ffed;
      border-left: 3px solid #52c41a;
    }
    .status {
      color: #666;
      font-style: italic;
    }
    input[type="text"] {
      width: 70%;
      padding: 8px;
    }
  </style>
</head>
<body>
  <h1>SAL SDK 오디오 메시징 데모</h1>
  
  <div>
    <h3>오디오 통신</h3>
    <button id="initBtn">초기화</button>
    <button id="startListeningBtn">수신 시작</button>
    <button id="stopListeningBtn">수신 중지</button>
    <div style="margin-top: 15px;">
      <input type="text" id="messageInput" placeholder="전송할 메시지 입력">
      <button id="sendBtn">전송</button>
      <label><input type="checkbox" id="fastMode"> 빠른 전송 모드</label>
    </div>
  </div>
  
  <div id="log"></div>

  <!-- SAL SDK 로드 (내장 ggwave.js 포함) -->
  <script src="./sal-sdk.js"></script>
  
  <script>
    // DOM 요소
    const initBtn = document.getElementById('initBtn');
    const startListeningBtn = document.getElementById('startListeningBtn');
    const stopListeningBtn = document.getElementById('stopListeningBtn');
    const sendBtn = document.getElementById('sendBtn');
    const messageInput = document.getElementById('messageInput');
    const fastModeCheckbox = document.getElementById('fastMode');
    const logContainer = document.getElementById('log');
    
    // 로그 출력 함수
    function log(message, type = 'status') {
      const messageElement = document.createElement('div');
      messageElement.className = `message ${type}`;
      messageElement.textContent = message;
      logContainer.appendChild(messageElement);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
    
    // 초기 상태 설정
    let audioCodec = null;
    
    // 버튼 이벤트 리스너
    initBtn.addEventListener('click', async () => {
      try {
        log('오디오 코덱 초기화 중...');
        
        // AudioCodec 인스턴스 생성
        audioCodec = new window.salSDK.AudioCodec();
        
        // 초기화
        const result = await audioCodec.init();
        
        if (result) {
          log('오디오 코덱 초기화 성공');
          
          // 메시지 이벤트 리스너 등록
          audioCodec.onMessage((event) => {
            log(`메시지 수신: ${event.message}`, event.source === 'self' ? 'sent' : 'received');
          });
        } else {
          log('오디오 코덱 초기화 실패');
        }
      } catch (error) {
        log(`초기화 오류: ${error.message}`);
        console.error(error);
      }
    });
    
    startListeningBtn.addEventListener('click', async () => {
      if (!audioCodec) {
        log('먼저 초기화 버튼을 클릭하세요.');
        return;
      }
      
      try {
        log('오디오 수신 시작 중...');
        const result = await audioCodec.startListening();
        
        if (result) {
          log('오디오 수신 시작됨');
        } else {
          log('오디오 수신 시작 실패');
        }
      } catch (error) {
        log(`수신 시작 오류: ${error.message}`);
        console.error(error);
      }
    });
    
    stopListeningBtn.addEventListener('click', () => {
      if (!audioCodec) {
        log('먼저 초기화 버튼을 클릭하세요.');
        return;
      }
      
      try {
        audioCodec.stopListening();
        log('오디오 수신 중지됨');
      } catch (error) {
        log(`수신 중지 오류: ${error.message}`);
        console.error(error);
      }
    });
    
    sendBtn.addEventListener('click', async () => {
      if (!audioCodec) {
        log('먼저 초기화 버튼을 클릭하세요.');
        return;
      }
      
      const message = messageInput.value.trim();
      if (!message) {
        log('메시지를 입력하세요.');
        return;
      }
      
      try {
        log(`메시지 전송 중: ${message}`);
        const result = await audioCodec.sendMessage(message, fastModeCheckbox.checked);
        
        if (result) {
          log(`메시지 전송 완료: ${message}`, 'sent');
          messageInput.value = '';
        } else {
          log('메시지 전송 실패');
        }
      } catch (error) {
        log(`전송 오류: ${error.message}`);
        console.error(error);
      }
    });
    
    // 페이지 로드 시 로그 출력
    window.addEventListener('DOMContentLoaded', () => {
      log('페이지 로드됨');
      log('사용 방법: "초기화" 버튼을 클릭하고, "수신 시작" 버튼을 클릭한 후 메시지를 입력하여 전송하세요.');
      
      // SDK 확인
      if (window.salSDK) {
        log('SAL SDK 로드됨');
      } else {
        log('SAL SDK 로드 실패');
      }
    });
  </script>
</body>
</html> 